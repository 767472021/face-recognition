# face-recognition
Perform face recognition in video stream for registered members. This repo is based on https://www.pyimagesearch.com/2018/09/24/opencv-face-recognition/<br>

The face recognition pipeline can be summarized as follow. <br>
When an video frame is fed into the system, it first performs **face detection** using a pre-trained Convolution Neural Network (CNN) model (ResNet + SSD) and returns a set of Region Of Interest (ROI). <br>

Then the cropped face images are passed to another pre-trained CNN model to perform **face encoding** (FaceNet architecture trained by OpenFace) and returns a list of 128-dimension vectors for each face.<br>

Finally, **face recognition** is performed on the 128-dimension vectors using various methods. In this repo, we use machine learning methods including Support Vector Machine (SVM), k-Nearest Neighbours (k-NN), and Random Forest. Moreover, we also use non-machine learning methods -- Pearson correlation, Cosine similarity, L2, and L1 distance.

# Installation
## Pre-requisite
The python scripts are written for Python 3 only and requires the following modules <br>
1. opencv-python
2. imutils
3. sklearn
4. numpy
5. tkinter

## Clone this repo
`$ git clone https://github.com/newTypeGeek/face-recognition`

# How to run
`$ python3 main.py`

Then you will see a GUI as shown below with `Total number of member = 0`.<br>

<img src="https://github.com/newTypeGeek/face-recognition/blob/master/gui.png" width="360">

1. **Registration** button registers a member given the valid *First Name* and *Last Name* input. Next, user is asked to
   take up to 10 photos to complete the registration. The photos would be stored in `dataset/<your_name>`. Then, the `Total number of member` in GUI should be incremented by one.

2. **Add photos** button takes additional for an existing member given the First Name and Last Name input.

3. **Face Recognition (method)** button starts performing face recognition from a video stream using the *method*.

4. **Information** button shows the reference of this program.

5. **Restart** button clears and re-generates all the `embeddings.pickle` and `face_recognition_model` files, based on the current images in the `dataset` directory.
*This button is useful if user adds or delete photos without interacting with the GUI.
This procedure also occurs when the program starts (i.e. $ python3 main.py)*

6. **Quit** button closes the program immediately.



## Understanding the files and directories
1. `dataset` <br> 
It consists of all the images from all registered members + `unknown`.
All images are named from `0000` to `9999`. At the beginning, you should only see the following
    ```
    dataset
    └── unknown
        ├── 0000.png
        ├── 0001.png
        ├── 0002.png
        ├── 0003.png
        └── 0004.png
    ```
where the images are generated by some GANs.<br><br>


2. `embeddings` <br>
    It consists of the embedding model and data of 128-d vectors
    - `embeddings.pickle` is the serialized Python dictionary with keys being the image paths, and values being 128-d vectors
    - `embeddings/data/individual/<identity>/embeddings.pickle` stores the 128-d vectors
      corresponds to that <identity>
    - `embeddings/data/overall/embeddings.pickle` stores the 128-d vectors of ALL <identity>
    - `openface_nn4.small2.v1.t7` is the pre-trained FaceNet CNN to extract 128-d vectors from a face
    ```
    embeddings
    ├── data
    │   ├── individual
    │   │   └── unknown
    │   │       └── embeddings.pickle
    │   └── overall
    │       └── embeddings.pickle
    └── model
        └── openface_nn4.small2.v1.t7
    ```
    <br><br>

3. `face_detection_model`<br>
    It consists of the pre-trained model which is used to locate the face candidates from an image
    - deploy.prototxt is the architecture of the CNN.
    - res10_300x300_ssd_iter_140000.caffemodel is the pre-trained weights of this CNN.
    ```
    face_detection_model
    ├── deploy.prototxt
    └── res10_300x300_ssd_iter_140000.caffemodel
    ```
    <br><br>

4. `face_recognition_model`<br>
    It *will* consist of trained face recognition model
    - label.pickle is the serialized encoding of the identity
    - model.pickle is the serialized model<br>
    ```
    face_recognition_model
    ├── knn
    ├── rf
    └── svm
    ```
Rightnow, the sub-directories `knn` (k-Nearest Neighbour), `rf` (Random Forest), and `svm` (Support Vector Machine) are empty.
The `label.pickle` and `model.pickle` files will be generated when the number of registered member > 0.<br><br>

5. `result`<br>
    It consists of manually captured images when performing face recognition from video stream 
    using various face recognition method. Rightnow, the sub-directories are empty.
    ```
    result
    ├── cosine
    ├── knn
    ├── l1
    ├── l2
    ├── pearson
    ├── rf
    └── svm
    ```
